<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Crack The Vault</title>
		<style>
			:root {
				--bg: #0f172a;
				--panel: #111827;
				--text: #e5e7eb;
				--muted: #9ca3af;
			--accent: #22c55e;
			--blue: #3b82f6; /* bulls: correct digit & position */
			--yellow: #f59e0b; /* cows: correct digit wrong position */
				--error: #ef4444;
				--border: #1f2937;
			}
			* { box-sizing: border-box; }
			body {
				margin: 0;
				font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
				background: radial-gradient(1000px 600px at 20% -10%, #1f2937, transparent),
										radial-gradient(1000px 600px at 120% 10%, #1f2937, transparent),
										var(--bg);
				color: var(--text);
				min-height: 100vh;
				display: grid;
				place-items: center;
				padding: 24px;
			}
			.card {
				width: 100%;
				max-width: 680px;
				background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
				border: 1px solid var(--border);
				border-radius: 16px;
				padding: 20px 20px 16px;
				box-shadow: 0 10px 30px rgba(0,0,0,0.25);
				backdrop-filter: blur(6px);
			}
			h1 {
				margin: 6px 0 0;
				font-size: 20px;
			}
					.result {
						margin: 10px 0 6px;
						padding: 10px 12px;
						border-radius: 10px;
						border: 1px solid var(--border);
						background: #0b1020;
						font-size: 16px;
						font-weight: 800;
						letter-spacing: 0.06em;
						display: none;
						text-transform: uppercase;
					}
					.result.ok { border-color: #14532d; background: #0a1a12; color: var(--accent); display: block; }
					.result.bad { border-color: #7f1d1d; background: #220909; color: var(--error); display: block; }
			.subtitle {
				margin: 6px 0 12px;
				color: var(--muted);
				font-size: 13px;
			}
			.row {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				align-items: center;
			}
			input[type="text"] {
				flex: 1 1 220px;
				min-width: 180px;
				padding: 12px 14px;
				border-radius: 10px;
				background: #0b1020;
				border: 1px solid var(--border);
				color: var(--text);
				outline: none;
				letter-spacing: 0.12em;
				font-weight: 700;
				font-size: 18px;
			}
			input[type="text"]:focus {
				border-color: #334155;
				box-shadow: 0 0 0 3px rgba(51, 65, 85, 0.4);
			}
			button {
				padding: 12px 16px;
				border: 1px solid var(--border);
				background: #0b1020;
				color: var(--text);
				border-radius: 10px;
				cursor: pointer;
				font-weight: 600;
			}
			button.primary { border-color: #14532d; background: #0a1a12; }
			button.primary:hover { background: #0d2618; }
			button.secondary:hover { background: #0d1222; }
			button:disabled { opacity: 0.5; cursor: not-allowed; }

			.meta {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-top: 10px;
				gap: 8px;
				flex-wrap: wrap;
				color: var(--muted);
				font-size: 13px;
			}
			.tries {
				font-weight: 700;
				color: #cbd5e1;
			}
			.history {
				margin-top: 14px;
				border-top: 1px dashed var(--border);
				padding-top: 10px;
			}
			.history h3 {
				margin: 0 0 8px;
				font-size: 14px;
				color: #cbd5e1;
			}
			.list {
				display: grid;
				gap: 8px;
			}
			.entry {
				display: grid;
			grid-template-columns: minmax(140px, auto) 1fr auto;
				gap: 10px;
				align-items: center;
				padding: 10px 12px;
				border: 1px solid var(--border);
				border-radius: 10px;
				background: #0b1020;
			}
			.tag {
				display: inline-block;
				padding: 2px 8px;
				border-radius: 999px;
				font-size: 12px;
				border: 1px solid var(--border);
				background: #0a1322;
				color: #cbd5e1;
			}
			.ok { color: var(--accent); border-color: #14532d; background: #0a1a12; }
			.warn { color: var(--yellow); border-color: #7c4a05; background: #221504; }
			.bad { color: var(--error); border-color: #7f1d1d; background: #220909; }

			.chip { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); }
			.chip.blue { color: var(--blue); border-color:#1d4ed8; background:#0b1330; }
			.chip.yellow { color: var(--yellow); border-color:#7c4a05; background:#221504; }
			.chip.miss { color: #9aa3b1; border-color:#2a3444; background:#0b1220; }
			.digit-row { display:flex; gap:6px; align-items:center; flex-wrap:nowrap; }

			.status {
				margin-top: 10px;
				padding: 10px 12px;
				border-radius: 10px;
				border: 1px solid var(--border);
				background: #0b1020;
				font-size: 14px;
			}
			.status.ok { border-color: #14532d; background: #0a1a12; color: var(--accent); }
			.status.bad { border-color: #7f1d1d; background: #220909; color: var(--error); }
			.status.warn { border-color: #7c4a05; background: #221504; color: var(--warn); }

			/* Footer */
			.site-footer {
				margin-top: 18px;
				color: var(--muted);
				font-size: 12px;
				text-align: center;
			}
			.site-footer a {
				color: #93c5fd;
				text-decoration: none;
				border-bottom: 1px dotted #334155;
			}
			.site-footer a:hover { text-decoration: underline; }
		</style>
	</head>
	<body>
			<main class="card" role="application" aria-label="Crack the Vault number game">
				<h1>Crack The Vault</h1>
				<p class="subtitle">Crack the vault and win Silver! Code is 4 digits (0001–9999). Blue = correct digit & position. Yellow = correct digit, wrong position. 4 tries. 0 and repeats allowed.</p>

			<div id="result" class="result" aria-live="polite" aria-atomic="true" tabindex="-1"></div>

			<div class="row" role="form" aria-label="guess form">
				<input
					id="guess-input"
					type="text"
					inputmode="numeric"
					autocomplete="off"
					pattern="^\\d{4}$"
					maxlength="4"
					placeholder="Enter 4 digits e.g. 0077"
					aria-label="Enter your 4-digit guess"
				/>
				<button id="guess-btn" type="button" class="primary" aria-label="Submit guess">Guess</button>
				<button id="reset-btn" type="button" class="secondary" aria-label="Play again" hidden>Play again</button>
			</div>

			<div class="meta">
			<div>Blue = right digit & position. Yellow = right digit, wrong position.</div>
				<div class="tries">Tries left: <span id="tries-left">4</span></div>
			</div>

			<div id="status" class="status" aria-live="polite"></div>

			<section class="history" aria-label="guess history">
				<h3>Guesses</h3>
				<div id="history" class="list" aria-live="polite"></div>
			</section>
		</main>

		<footer class="site-footer" role="contentinfo">
			© 2025 <a href="https://github.com/khagendra-poudel" target="_blank" rel="noopener">Khagendra Poudel</a>
		</footer>

		<script>
			(function () {
				'use strict';

				const input = document.getElementById('guess-input');
				const guessBtn = document.getElementById('guess-btn');
				const resetBtn = document.getElementById('reset-btn');
			const triesEl = document.getElementById('tries-left');
				const historyEl = document.getElementById('history');
				const statusEl = document.getElementById('status');
			const resultEl = document.getElementById('result');

			let secret = [];
				let triesLeft = 4;
				let finished = false;

				function randDigit() { return Math.floor(Math.random() * 10); }
						function newSecret() {
							// Ensure the secret is not 0000 (range 0001–9999), but 0 is still a valid digit and repeats are allowed
							let s;
							do {
								s = [randDigit(), randDigit(), randDigit(), randDigit()];
							} while (s[0] === 0 && s[1] === 0 && s[2] === 0 && s[3] === 0);
							return s;
						}

				function setStatus(message, kind = '') {
					statusEl.textContent = message || '';
					statusEl.className = 'status' + (kind ? ' ' + kind : '');
				}

				function reset() {
					secret = newSecret();
					triesLeft = 4;
					finished = false;
					historyEl.innerHTML = '';
					triesEl.textContent = String(triesLeft);
					input.value = '';
					input.disabled = false;
					guessBtn.disabled = false;
					resetBtn.hidden = true;
				  resultEl.className = 'result';
				  resultEl.textContent = '';
					  setStatus('Vault ready. Enter your 4-digit guess.');
					input.focus();
					// Uncomment to debug the secret: console.log('SECRET:', secret.join(''));
				}

				function isValidGuess(value) {
					return /^\d{4}$/.test(value);
				}

				function score(guessStr, secretArr) {
					const g = guessStr.split('').map((d) => Number(d));
					const s = secretArr;
					let bulls = 0;
					const countG = new Array(10).fill(0);
					const countS = new Array(10).fill(0);
					for (let i = 0; i < 4; i++) {
						if (g[i] === s[i]) {
							bulls++;
						} else {
							countG[g[i]]++;
							countS[s[i]]++;
						}
					}
					let cows = 0;
					for (let d = 0; d < 10; d++) cows += Math.min(countG[d], countS[d]);
					return { bulls, cows };
				}

						function annotateGuess(guessStr, secretArr) {
							const g = guessStr.split('').map((d) => Number(d));
							const s = secretArr;
							const states = new Array(4).fill('miss');
							const remaining = new Array(10).fill(0);
							// First pass: mark bulls and collect remaining secret counts
							for (let i = 0; i < 4; i++) {
								if (g[i] === s[i]) {
									states[i] = 'bull';
								} else {
									remaining[s[i]]++;
								}
							}
							// Second pass: mark cows using remaining counts (avoid double-count)
							for (let i = 0; i < 4; i++) {
								if (states[i] === 'miss') {
									const d = g[i];
									if (remaining[d] > 0) {
										states[i] = 'cow';
										remaining[d]--;
									}
								}
							}
							return states; // 'bull' | 'cow' | 'miss'
						}

								function renderEntry(guessStr, bulls, cows) {
					const entry = document.createElement('div');
					entry.className = 'entry';

									const digitRow = document.createElement('div');
									digitRow.className = 'digit-row';
									const states = annotateGuess(guessStr, secret);
									for (let i = 0; i < 4; i++) {
										const span = document.createElement('span');
										const cls = states[i] === 'bull' ? 'blue' : states[i] === 'cow' ? 'yellow' : 'miss';
										span.className = `chip ${cls}`;
										span.textContent = guessStr[i];
										span.title = states[i] === 'bull' ? 'Correct digit and position' : states[i] === 'cow' ? 'Correct digit, wrong position' : 'Not in code';
										digitRow.appendChild(span);
									}

					const bc = document.createElement('div');
							bc.innerHTML = `<span class="chip blue">${bulls} blue</span> ` +
														 `<span class="chip yellow">${cows} yellow</span>`;

					const emoji = document.createElement('div');
							emoji.className = 'tag ' + (bulls === 4 ? 'ok' : cows + bulls > 0 ? 'warn' : 'bad');
					emoji.textContent = bulls === 4 ? '✔' : (cows + bulls > 0 ? '↔' : '✖');

									entry.appendChild(digitRow);
					entry.appendChild(bc);
					entry.appendChild(emoji);
					historyEl.prepend(entry);
				}

				function endGame(win) {
					finished = true;
					input.disabled = true;
					guessBtn.disabled = true;
					resetBtn.hidden = false;
					const reveal = `The code was ${secret.join('')}.`;
							if (win) {
								resultEl.className = 'result ok';
								resultEl.textContent = 'YOU WIN';
								setStatus(`You cracked the vault! ${reveal}`, 'ok');
							} else {
								resultEl.className = 'result bad';
								resultEl.textContent = 'YOU LOSE';
								setStatus(`Out of tries. ${reveal}`, 'bad');
							}
					// Focus a non-interactive element so releasing Enter won't trigger a click
					try { resultEl.focus({ preventScroll: true }); } catch {}
				}

				function handleGuess() {
					if (finished) return;
					const raw = input.value.trim();
					if (!isValidGuess(raw)) {
						setStatus('Please enter exactly 4 digits (0-9).', 'warn');
						input.focus();
						return;
					}

					const { bulls, cows } = score(raw, secret);
					renderEntry(raw, bulls, cows);

					if (bulls === 4) {
						endGame(true);
						return;
					}

					triesLeft--;
					triesEl.textContent = String(triesLeft);

					if (triesLeft <= 0) {
						endGame(false);
					} else {
						setStatus(`${bulls} blue, ${cows} yellow. Keep going!`);
						input.value = '';
						input.focus();
					}
				}

				// Wire up events
				guessBtn.addEventListener('click', handleGuess);
				input.addEventListener('keydown', (e) => {
					if (e.key === 'Enter') handleGuess();
				});
				resetBtn.addEventListener('click', reset);
				// Basic input guard to keep only digits and up to 4 chars
				input.addEventListener('input', () => {
					input.value = (input.value || '').replace(/\D/g, '').slice(0, 4);
				});

				// Start the first game
				reset();
			})();
		</script>
	</body>
	</html>

